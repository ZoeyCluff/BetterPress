---

  - name: install packages
    when: (ansible_distribution == "Debian" or ansible_distribution == "Ubuntu")
    apt: name='{{ item }}' state=present
    with_items:
      - nginx
      - php7.3
      - php7.3-mysql
      - php7.3-fpm
      - php7.3-cli
      - php7.3-gd
      - php7.3-json
      - php7.3-mbstring
      - php7.3-readline
      - php7.3-xml
      - php7.3-zip
      - python-pip
      - mysql-server
      - mysql-client
      - libmysqlclient-dev
      - python-mysqldb
      - unzip
    register: task_result
    until: task_result is success
    retries: 10
    delay: 2

  - name: install caching
    when: (caching == "True" and ansible_distribution == "Debian" or ansible_distribution == "Ubuntu")
    apt:
      name: memcached
      state: present
    register: task_result
    until: task_result is success
    retries: 10
    delay: 2

  - name: install certbot
    when: (leEmail is defined and ansible_distribution == "Debian" or ansible_distribution == "Ubuntu")
    apt:
      name: certbot
      state: present
    register: task_result
    until: task_result is success
    retries: 10
    delay: 2
